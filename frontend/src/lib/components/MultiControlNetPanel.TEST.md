# MultiControlNetPanel 测试指南

## 测试概述

本文档提供 `MultiControlNetPanel` 组件的完整测试指南，包括功能测试、集成测试和用户场景测试。

## 测试环境准备

### 1. 启动开发服务器

```bash
# 后端
cd streamdiffusion-mvp
python -m app.main

# 前端
cd frontend
npm run dev
```

### 2. 准备测试图像

准备以下测试图像：
- `test-canny.png`: 边缘检测图像
- `test-depth.png`: 深度图
- `test-pose.png`: 姿态图像

## 功能测试清单

### ✅ 测试 1: 组件渲染

**目标:** 验证组件正确渲染

**步骤:**
1. 打开包含 MultiControlNetPanel 的页面
2. 检查组件是否显示

**预期结果:**
- ✅ 显示标题 "🎮 多ControlNet控制"
- ✅ 显示计数器 "0 / 3"
- ✅ 显示空状态提示
- ✅ 显示"+ 添加ControlNet"按钮

**实际结果:** _____

---

### ✅ 测试 2: 添加 ControlNet

**目标:** 验证添加 ControlNet 功能

**步骤:**
1. 点击"+ 添加ControlNet"按钮
2. 观察界面变化

**预期结果:**
- ✅ 显示新的 ControlNet 配置面板
- ✅ 计数器更新为 "1 / 3"
- ✅ 显示默认配置（类型、权重等）

**实际结果:** _____

---

### ✅ 测试 3: 删除 ControlNet

**目标:** 验证删除 ControlNet 功能

**步骤:**
1. 添加一个 ControlNet
2. 点击删除按钮（✕）
3. 观察界面变化

**预期结果:**
- ✅ ControlNet 配置面板消失
- ✅ 计数器更新为 "0 / 3"
- ✅ 显示空状态提示

**实际结果:** _____

---

### ✅ 测试 4: 最大数量限制

**目标:** 验证最多只能添加 3 个 ControlNet

**步骤:**
1. 连续点击"+ 添加ControlNet"按钮 4 次
2. 观察界面变化

**预期结果:**
- ✅ 只能添加 3 个 ControlNet
- ✅ 第 4 次点击显示错误提示
- ✅ 计数器显示 "3 / 3"
- ✅ 添加按钮被禁用或隐藏

**实际结果:** _____

---

### ✅ 测试 5: 类型选择

**目标:** 验证 ControlNet 类型选择功能

**步骤:**
1. 添加一个 ControlNet
2. 点击类型下拉菜单
3. 选择不同的类型

**预期结果:**
- ✅ 下拉菜单显示所有可用类型
- ✅ 选择后类型更新
- ✅ 控制台输出类型变化日志

**实际结果:** _____

---

### ✅ 测试 6: 图像上传

**目标:** 验证图像上传功能

**步骤:**
1. 添加一个 ControlNet
2. 点击"选择文件"按钮
3. 选择一个图像文件
4. 观察预览

**预期结果:**
- ✅ 文件选择对话框打开
- ✅ 选择后图像加载
- ✅ 显示图像预览
- ✅ 预览图像尺寸合适（最大高度 128px）

**实际结果:** _____

---

### ✅ 测试 7: 无效文件处理

**目标:** 验证上传非图像文件时的错误处理

**步骤:**
1. 添加一个 ControlNet
2. 尝试上传非图像文件（如 .txt、.pdf）
3. 观察错误提示

**预期结果:**
- ✅ 显示错误提示
- ✅ 错误消息清晰明确
- ✅ 提供解决建议

**实际结果:** _____

---

### ✅ 测试 8: 权重调整

**目标:** 验证权重滑块功能

**步骤:**
1. 添加一个 ControlNet
2. 拖动权重滑块
3. 观察数值变化

**预期结果:**
- ✅ 滑块可以拖动
- ✅ 数值实时更新
- ✅ 范围在 0.0 - 2.0 之间
- ✅ 显示两位小数

**实际结果:** _____

---

### ✅ 测试 9: 引导范围调整

**目标:** 验证引导开始/结束滑块功能

**步骤:**
1. 添加一个 ControlNet
2. 分别调整"引导开始"和"引导结束"滑块
3. 观察数值变化

**预期结果:**
- ✅ 两个滑块都可以独立调整
- ✅ 数值实时更新
- ✅ 范围在 0.0 - 1.0 之间
- ✅ 显示两位小数

**实际结果:** _____

---

### ✅ 测试 10: 多个 ControlNet 独立配置

**目标:** 验证多个 ControlNet 可以独立配置

**步骤:**
1. 添加 3 个 ControlNet
2. 为每个设置不同的类型、权重和图像
3. 验证配置独立性

**预期结果:**
- ✅ 每个 ControlNet 有独立的配置
- ✅ 修改一个不影响其他
- ✅ 所有配置正确保存

**实际结果:** _____

---

## API 测试清单

### ✅ 测试 11: getControlNets() 方法

**目标:** 验证获取配置方法

**步骤:**
```javascript
// 在浏览器控制台执行
const panel = document.querySelector('MultiControlNetPanel');
const controlnets = panel.getControlNets();
console.log(controlnets);
```

**预期结果:**
- ✅ 返回数组
- ✅ 只包含已上传图像的 ControlNet
- ✅ 每个对象包含所有必需字段

**实际结果:** _____

---

### ✅ 测试 12: validate() 方法 - 有效配置

**目标:** 验证配置验证方法（有效情况）

**步骤:**
1. 添加 ControlNet 并上传图像
2. 调用 validate() 方法

**预期结果:**
- ✅ 返回 `{ valid: true }`
- ✅ 无错误消息

**实际结果:** _____

---

### ✅ 测试 13: validate() 方法 - 无效配置

**目标:** 验证配置验证方法（无效情况）

**步骤:**
1. 添加 ControlNet 但不上传图像
2. 调用 validate() 方法

**预期结果:**
- ✅ 返回 `{ valid: false, message: '...' }`
- ✅ 错误消息清晰

**实际结果:** _____

---

## 集成测试清单

### ✅ 测试 14: 与主页面集成

**目标:** 验证组件在主页面中正常工作

**步骤:**
1. 在主页面添加 MultiControlNetPanel
2. 配置 ControlNet
3. 触发生成

**预期结果:**
- ✅ 组件正常渲染
- ✅ 配置可以获取
- ✅ 与其他组件无冲突

**实际结果:** _____

---

### ✅ 测试 15: 与画板页面集成

**目标:** 验证组件在画板页面中正常工作

**步骤:**
1. 在画板页面添加 MultiControlNetPanel
2. 配置 ControlNet
3. 进行实时生成

**预期结果:**
- ✅ 组件正常渲染
- ✅ 实时生成正常
- ✅ 性能可接受

**实际结果:** _____

---

### ✅ 测试 16: API 调用

**目标:** 验证与后端 API 的集成

**步骤:**
1. 配置多个 ControlNet
2. 调用生成 API
3. 检查请求和响应

**预期结果:**
- ✅ API 请求格式正确
- ✅ 参数正确传递
- ✅ 响应正确处理

**实际结果:** _____

---

## 用户场景测试

### ✅ 场景 1: 精确重绘

**目标:** 使用 Canny 边缘检测进行精确重绘

**步骤:**
1. 添加 Canny ControlNet
2. 上传边缘检测图像
3. 设置权重 1.2
4. 生成图像

**预期结果:**
- ✅ 生成图像保持原图结构
- ✅ 边缘清晰
- ✅ 细节丰富

**实际结果:** _____

---

### ✅ 场景 2: 多 ControlNet 组合

**目标:** 使用多个 ControlNet 进行复杂控制

**步骤:**
1. 添加 Depth ControlNet（权重 0.8）
2. 添加 Lineart ControlNet（权重 0.6）
3. 上传对应图像
4. 生成图像

**预期结果:**
- ✅ 同时保持深度和线条
- ✅ 两个 ControlNet 效果融合
- ✅ 生成质量高

**实际结果:** _____

---

### ✅ 场景 3: 引导范围控制

**目标:** 使用引导范围控制 ControlNet 作用时机

**步骤:**
1. 添加 ControlNet
2. 设置引导范围 0.0 - 0.5（前半段）
3. 生成图像
4. 对比全程引导的效果

**预期结果:**
- ✅ 前半段受 ControlNet 影响
- ✅ 后半段更自由
- ✅ 效果符合预期

**实际结果:** _____

---

## 性能测试

### ✅ 测试 17: 组件加载性能

**目标:** 验证组件加载速度

**步骤:**
1. 打开包含组件的页面
2. 测量加载时间

**预期结果:**
- ✅ 加载时间 < 1 秒
- ✅ 无明显卡顿

**实际结果:** _____

---

### ✅ 测试 18: 图像上传性能

**目标:** 验证大图像上传性能

**步骤:**
1. 上传大尺寸图像（如 2048x2048）
2. 观察加载时间和内存使用

**预期结果:**
- ✅ 加载时间可接受（< 3 秒）
- ✅ 无内存泄漏
- ✅ 预览正常显示

**实际结果:** _____

---

### ✅ 测试 19: 多 ControlNet 性能

**目标:** 验证 3 个 ControlNet 同时使用的性能

**步骤:**
1. 添加 3 个 ControlNet
2. 为每个上传图像
3. 观察界面响应性

**预期结果:**
- ✅ 界面流畅
- ✅ 无明显延迟
- ✅ 内存使用合理

**实际结果:** _____

---

## 响应式测试

### ✅ 测试 20: 移动端适配

**目标:** 验证移动端显示效果

**步骤:**
1. 在移动设备或模拟器中打开
2. 测试所有功能

**预期结果:**
- ✅ 布局适配良好
- ✅ 触摸操作正常
- ✅ 文字大小合适

**实际结果:** _____

---

### ✅ 测试 21: 不同屏幕尺寸

**目标:** 验证不同屏幕尺寸的适配

**步骤:**
1. 在不同尺寸屏幕测试（手机、平板、桌面）
2. 检查布局和功能

**预期结果:**
- ✅ 所有尺寸都正常显示
- ✅ 布局合理
- ✅ 功能完整

**实际结果:** _____

---

## 错误处理测试

### ✅ 测试 22: 网络错误

**目标:** 验证网络错误处理

**步骤:**
1. 断开网络连接
2. 尝试获取 ControlNet 类型
3. 观察错误处理

**预期结果:**
- ✅ 显示错误提示
- ✅ 使用默认类型列表
- ✅ 不影响其他功能

**实际结果:** _____

---

### ✅ 测试 23: API 错误

**目标:** 验证 API 错误处理

**步骤:**
1. 模拟 API 返回错误
2. 观察错误处理

**预期结果:**
- ✅ 显示清晰的错误消息
- ✅ 提供解决建议
- ✅ 可以恢复操作

**实际结果:** _____

---

## 测试总结

### 通过的测试
- [ ] 测试 1: 组件渲染
- [ ] 测试 2: 添加 ControlNet
- [ ] 测试 3: 删除 ControlNet
- [ ] 测试 4: 最大数量限制
- [ ] 测试 5: 类型选择
- [ ] 测试 6: 图像上传
- [ ] 测试 7: 无效文件处理
- [ ] 测试 8: 权重调整
- [ ] 测试 9: 引导范围调整
- [ ] 测试 10: 多个 ControlNet 独立配置
- [ ] 测试 11: getControlNets() 方法
- [ ] 测试 12: validate() 方法 - 有效配置
- [ ] 测试 13: validate() 方法 - 无效配置
- [ ] 测试 14: 与主页面集成
- [ ] 测试 15: 与画板页面集成
- [ ] 测试 16: API 调用
- [ ] 场景 1: 精确重绘
- [ ] 场景 2: 多 ControlNet 组合
- [ ] 场景 3: 引导范围控制
- [ ] 测试 17: 组件加载性能
- [ ] 测试 18: 图像上传性能
- [ ] 测试 19: 多 ControlNet 性能
- [ ] 测试 20: 移动端适配
- [ ] 测试 21: 不同屏幕尺寸
- [ ] 测试 22: 网络错误
- [ ] 测试 23: API 错误

### 发现的问题
1. _____
2. _____
3. _____

### 改进建议
1. _____
2. _____
3. _____

---

**测试日期:** _____  
**测试人员:** _____  
**测试环境:** _____  
**测试结果:** ✅ 通过 / ❌ 失败
