# UpscalePanel 测试指南

## 测试概述

本文档提供 `UpscalePanel` 组件的完整测试指南，包括功能测试、集成测试和用户验收测试。

## 前置条件

### 后端要求
- ✅ 后端服务正常运行
- ✅ `/api/upscale` 端点可用
- ✅ `upscale_pipeline` 已初始化
- ✅ Real-ESRGAN 模型已加载（可选）

### 测试环境
- ✅ 浏览器支持 Canvas API
- ✅ 浏览器支持 File API
- ✅ 网络连接正常

### 测试数据
准备以下测试图像：
- 小图像（< 512px）
- 中等图像（512px - 1024px）
- 大图像（> 1024px）
- 不同格式（PNG、JPG、WebP）

## 功能测试清单

### 1. 图像上传功能

#### 测试 1.1: 正常图像上传
**步骤**:
1. 点击"选择图像"按钮
2. 选择一个有效的图像文件（PNG/JPG）
3. 观察预览区域

**预期结果**:
- ✅ 图像正确显示在预览区域
- ✅ 显示原始尺寸信息
- ✅ 显示目标尺寸预览
- ✅ 无错误提示

#### 测试 1.2: 无效文件类型
**步骤**:
1. 点击"选择图像"按钮
2. 选择非图像文件（如 .txt、.pdf）

**预期结果**:
- ✅ 显示错误提示："请选择图像文件"
- ✅ 提供解决建议
- ✅ 不显示预览

#### 测试 1.3: 更换图像
**步骤**:
1. 上传第一张图像
2. 点击"更换图像"按钮
3. 选择另一张图像

**预期结果**:
- ✅ 预览更新为新图像
- ✅ 尺寸信息更新
- ✅ 之前的结果被清除

### 2. 放大算法选择

#### 测试 2.1: Real-ESRGAN 算法
**步骤**:
1. 上传测试图像
2. 选择"Real-ESRGAN (高质量)"
3. 设置放大倍数为 2.0x
4. 点击"开始放大"

**预期结果**:
- ✅ 显示加载状态和进度条
- ✅ 成功生成放大图像
- ✅ 图像质量明显提升
- ✅ 显示"使用 Real-ESRGAN"提示

#### 测试 2.2: Lanczos 算法
**步骤**:
1. 上传测试图像
2. 选择"Lanczos (快速)"
3. 设置放大倍数为 2.0x
4. 点击"开始放大"

**预期结果**:
- ✅ 处理速度较快
- ✅ 成功生成放大图像
- ✅ 图像质量良好

#### 测试 2.3: Bicubic 算法
**步骤**:
1. 上传测试图像
2. 选择"Bicubic (标准)"
3. 设置放大倍数为 2.0x
4. 点击"开始放大"

**预期结果**:
- ✅ 处理速度中等
- ✅ 成功生成放大图像
- ✅ 图像质量标准

### 3. 放大倍数调整

#### 测试 3.1: 最小倍数 (1.0x)
**步骤**:
1. 上传测试图像
2. 将放大倍数设置为 1.0x
3. 点击"开始放大"

**预期结果**:
- ✅ 成功处理
- ✅ 输出图像尺寸与原始相同

#### 测试 3.2: 标准倍数 (2.0x)
**步骤**:
1. 上传测试图像（512x512）
2. 将放大倍数设置为 2.0x
3. 点击"开始放大"

**预期结果**:
- ✅ 成功处理
- ✅ 输出图像尺寸为 1024x1024

#### 测试 3.3: 最大倍数 (4.0x)
**步骤**:
1. 上传小测试图像（256x256）
2. 将放大倍数设置为 4.0x
3. 点击"开始放大"

**预期结果**:
- ✅ 成功处理
- ✅ 输出图像尺寸为 1024x1024
- ⚠️ 处理时间较长

#### 测试 3.4: 滑块交互
**步骤**:
1. 拖动放大倍数滑块
2. 观察数值变化和目标尺寸预览

**预期结果**:
- ✅ 滑块响应流畅
- ✅ 数值实时更新（显示一位小数）
- ✅ 目标尺寸实时计算

### 4. 进度显示

#### 测试 4.1: 进度条显示
**步骤**:
1. 上传测试图像
2. 点击"开始放大"
3. 观察进度显示

**预期结果**:
- ✅ 显示加载动画
- ✅ 显示进度条（0% → 100%）
- ✅ 显示进度文本提示
- ✅ 显示当前使用的算法

#### 测试 4.2: 进度完成
**步骤**:
1. 等待放大完成

**预期结果**:
- ✅ 进度达到 100%
- ✅ 显示"完成！"提示
- ✅ 2秒后进度条消失
- ✅ 显示结果图像

### 5. 结果显示和下载

#### 测试 5.1: 结果显示
**步骤**:
1. 完成一次放大操作
2. 观察结果区域

**预期结果**:
- ✅ 显示放大后的图像
- ✅ 显示放大倍数和算法信息
- ✅ 显示"下载"按钮
- ✅ 图像清晰可见

#### 测试 5.2: 结果下载
**步骤**:
1. 完成一次放大操作
2. 点击"下载"按钮

**预期结果**:
- ✅ 触发文件下载
- ✅ 文件名格式正确（upscaled_2.0x_timestamp.png）
- ✅ 下载的图像与显示的一致

### 6. 重置功能

#### 测试 6.1: 重置操作
**步骤**:
1. 上传图像并完成放大
2. 点击"重置"按钮

**预期结果**:
- ✅ 清除源图像
- ✅ 清除结果图像
- ✅ 参数恢复默认值（Real-ESRGAN, 2.0x）
- ✅ 清除所有错误提示

## 错误处理测试

### 7. 验证错误

#### 测试 7.1: 未选择图像
**步骤**:
1. 不上传图像
2. 直接点击"开始放大"

**预期结果**:
- ✅ 显示错误："请选择源图像"
- ✅ 提供建议："上传一张图像进行放大"
- ✅ 按钮保持禁用状态

### 8. API 错误

#### 测试 8.1: 后端服务不可用
**步骤**:
1. 停止后端服务
2. 上传图像并尝试放大

**预期结果**:
- ✅ 显示网络错误
- ✅ 提供建议："检查网络连接"、"确认后端服务正常运行"
- ✅ 停止加载状态

#### 测试 8.2: Pipeline 未初始化
**步骤**:
1. 后端未加载 upscale_pipeline
2. 尝试放大图像

**预期结果**:
- ✅ 显示错误："Upscale Pipeline 可能未初始化"
- ✅ 提供建议："检查后端配置"、"查看后端启动日志"

#### 测试 8.3: 无效图像数据
**步骤**:
1. 修改代码发送损坏的图像数据
2. 尝试放大

**预期结果**:
- ✅ 显示错误："图像放大失败"
- ✅ 提供相关建议
- ✅ 不崩溃

## 集成测试

### 9. 与主页面集成

#### 测试 9.1: 面板显示/隐藏
**步骤**:
1. 在主页面点击"图像放大"按钮
2. 观察面板显示
3. 再次点击按钮

**预期结果**:
- ✅ 面板正确显示
- ✅ 面板正确隐藏
- ✅ 状态保持正确

#### 测试 9.2: 与其他功能共存
**步骤**:
1. 打开 UpscalePanel
2. 同时打开其他面板（如 InpaintingPanel）

**预期结果**:
- ✅ 两个面板可以同时显示
- ✅ 互不干扰
- ✅ 各自功能正常

### 10. 与 HiresFixPanel 对比

#### 测试 10.1: 功能差异
**对比项**:
- UpscalePanel: 纯放大，无生成
- HiresFixPanel: 放大 + AI 生成细节

**验证**:
- ✅ UpscalePanel 不需要 Prompt
- ✅ UpscalePanel 处理速度更快
- ✅ HiresFixPanel 可以改变图像内容

## 性能测试

### 11. 不同图像尺寸

#### 测试 11.1: 小图像 (256x256)
**预期**:
- ✅ 处理时间 < 5秒（Real-ESRGAN）
- ✅ 处理时间 < 1秒（Lanczos/Bicubic）

#### 测试 11.2: 中等图像 (512x512)
**预期**:
- ✅ 处理时间 < 10秒（Real-ESRGAN）
- ✅ 处理时间 < 2秒（Lanczos/Bicubic）

#### 测试 11.3: 大图像 (1024x1024)
**预期**:
- ✅ 处理时间 < 30秒（Real-ESRGAN）
- ✅ 处理时间 < 5秒（Lanczos/Bicubic）

### 12. 内存使用

#### 测试 12.1: 多次放大
**步骤**:
1. 连续执行 10 次放大操作
2. 观察浏览器内存使用

**预期结果**:
- ✅ 内存使用稳定
- ✅ 无明显内存泄漏
- ✅ 页面响应正常

## 用户验收测试

### 13. 真实场景测试

#### 场景 1: 照片放大
**目标**: 放大一张低分辨率照片
**步骤**:
1. 上传 512x512 的照片
2. 选择 Real-ESRGAN
3. 设置 2.0x 放大
4. 执行放大并下载

**验收标准**:
- ✅ 放大后照片清晰
- ✅ 细节保留良好
- ✅ 无明显伪影

#### 场景 2: 艺术作品放大
**目标**: 放大一张艺术插画
**步骤**:
1. 上传艺术插画
2. 选择 Real-ESRGAN
3. 设置 3.0x 放大
4. 执行放大并下载

**验收标准**:
- ✅ 线条清晰
- ✅ 颜色准确
- ✅ 风格保持

#### 场景 3: 快速预览
**目标**: 快速查看放大效果
**步骤**:
1. 上传图像
2. 选择 Lanczos
3. 设置 2.0x 放大
4. 快速执行

**验收标准**:
- ✅ 处理速度快（< 2秒）
- ✅ 效果可接受
- ✅ 适合预览用途

## 测试报告模板

```markdown
## UpscalePanel 测试报告

**测试日期**: YYYY-MM-DD
**测试人员**: [姓名]
**测试环境**: 
- 浏览器: [Chrome/Firefox/Safari] [版本]
- 操作系统: [Windows/macOS/Linux]
- 后端版本: [版本号]

### 测试结果汇总
- 总测试用例: XX
- 通过: XX
- 失败: XX
- 跳过: XX

### 失败用例详情
1. [用例编号]: [失败原因]
2. ...

### 性能数据
- 小图像放大时间: X.X 秒
- 中等图像放大时间: X.X 秒
- 大图像放大时间: X.X 秒

### 问题和建议
1. [问题描述]
2. [改进建议]

### 总体评价
[通过/需要修复]
```

## 自动化测试（可选）

### 单元测试示例

```typescript
import { render, fireEvent, waitFor } from '@testing-library/svelte';
import UpscalePanel from './UpscalePanel.svelte';

describe('UpscalePanel', () => {
  it('should render upload button', () => {
    const { getByText } = render(UpscalePanel);
    expect(getByText('选择图像')).toBeInTheDocument();
  });
  
  it('should show error when no image selected', async () => {
    const { getByText } = render(UpscalePanel);
    const button = getByText('开始放大');
    
    await fireEvent.click(button);
    
    await waitFor(() => {
      expect(getByText('请选择源图像')).toBeInTheDocument();
    });
  });
  
  // 更多测试...
});
```

## 测试完成标准

- ✅ 所有功能测试通过
- ✅ 所有错误处理测试通过
- ✅ 集成测试通过
- ✅ 性能测试达标
- ✅ 用户验收测试通过
- ✅ 无已知严重 bug

## 维护者

AI Assistant

## 更新日志

- 2025-11-17: 初始版本
