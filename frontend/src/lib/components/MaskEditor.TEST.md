# MaskEditor 组件测试清单

## 测试概述

本文档提供 MaskEditor 组件的完整测试清单，确保所有功能正常工作。

## 测试环境

- **浏览器**: Chrome, Firefox, Safari, Edge
- **设备**: 桌面端、平板、手机
- **测试图像**: 准备多种尺寸和格式的测试图像

---

## 功能测试

### ✅ 1. 组件初始化

- [ ] 组件正常渲染
- [ ] Canvas 元素正确创建
- [ ] 默认工具为画笔
- [ ] 默认画笔大小为 30px
- [ ] 默认画笔硬度为 0.8
- [ ] 蒙版初始化为透明

### ✅ 2. 画笔工具

#### 基本功能
- [ ] 点击画笔按钮切换到画笔工具
- [ ] 画笔按钮高亮显示
- [ ] 在画布上绘制白色蒙版
- [ ] 连续绘制无断点
- [ ] 画笔大小正确应用

#### 画笔参数
- [ ] 画笔大小滑块正常工作（5-100px）
- [ ] 画笔硬度滑块正常工作（0.1-1.0）
- [ ] 画笔大小实时显示
- [ ] 画笔硬度百分比正确显示
- [ ] 硬度影响画笔边缘柔和度

#### 绘制质量
- [ ] 慢速绘制线条连续
- [ ] 快速绘制线条连续
- [ ] 画笔边缘平滑
- [ ] 硬度为 1.0 时边缘清晰
- [ ] 硬度为 0.1 时边缘柔和

### ✅ 3. 橡皮擦工具

#### 基本功能
- [ ] 点击橡皮擦按钮切换到橡皮擦工具
- [ ] 橡皮擦按钮高亮显示
- [ ] 在画布上擦除蒙版
- [ ] 擦除后区域完全透明
- [ ] 橡皮擦大小与画笔大小一致

#### 擦除效果
- [ ] 完全擦除已绘制的蒙版
- [ ] 部分擦除正常工作
- [ ] 连续擦除无断点
- [ ] 擦除边缘平滑

### ✅ 4. 填充工具

#### 基本功能
- [ ] 点击填充按钮切换到填充工具
- [ ] 填充按钮高亮显示
- [ ] 点击空白区域填充白色
- [ ] 点击已填充区域填充透明

#### 填充算法
- [ ] 正确识别连续区域
- [ ] 不会填充到边界外
- [ ] 填充速度可接受
- [ ] 大面积填充不卡顿
- [ ] 复杂形状填充正确

#### 边界处理
- [ ] 填充到画布边缘正确
- [ ] 填充到已绘制蒙版边缘正确
- [ ] 不会越界填充

### ✅ 5. 清除功能

- [ ] 点击清除按钮清空所有蒙版
- [ ] 清除后画布完全透明
- [ ] 清除后可以重新绘制
- [ ] 快捷键 C 清除蒙版

### ✅ 6. 反转功能

- [ ] 点击反转按钮反转蒙版
- [ ] 白色区域变为黑色
- [ ] 黑色区域变为白色
- [ ] 透明区域保持透明
- [ ] 反转两次恢复原状
- [ ] 快捷键 I 反转蒙版

### ✅ 7. 预览功能

#### 显示/隐藏
- [ ] 点击预览按钮显示源图像
- [ ] 再次点击隐藏源图像
- [ ] 预览按钮状态正确切换
- [ ] 预览图像半透明显示

#### 叠加效果
- [ ] 源图像和蒙版正确叠加
- [ ] 蒙版区域清晰可见
- [ ] 叠加不影响绘制功能
- [ ] 预览模式下可以正常绘制

### ✅ 8. 键盘快捷键

- [ ] B 键切换到画笔工具
- [ ] E 键切换到橡皮擦工具
- [ ] F 键切换到填充工具
- [ ] C 键清除蒙版
- [ ] I 键反转蒙版
- [ ] [ 键减小画笔大小
- [ ] ] 键增大画笔大小
- [ ] 快捷键在任何工具下都有效

### ✅ 9. 触摸支持

#### 触摸绘制
- [ ] 触摸屏上可以绘制
- [ ] 单指绘制正常
- [ ] 触摸绘制连续无断点
- [ ] 触摸结束停止绘制

#### 触摸手势
- [ ] 触摸不会触发页面滚动
- [ ] 触摸不会触发缩放
- [ ] 多点触摸正确处理

### ✅ 10. 公开方法

#### getMaskDataURL()
- [ ] 返回正确的 Data URL
- [ ] Data URL 格式为 PNG
- [ ] Data URL 可以用于图像显示
- [ ] Data URL 可以用于下载

#### getMaskImageData()
- [ ] 返回 ImageData 对象
- [ ] ImageData 尺寸正确
- [ ] ImageData 数据正确

#### setMaskFromDataURL()
- [ ] 可以从 Data URL 加载蒙版
- [ ] 加载后蒙版显示正确
- [ ] 加载后可以继续编辑

#### clearMask()
- [ ] 清除所有蒙版内容
- [ ] 清除后画布透明

#### invertMaskData()
- [ ] 反转蒙版颜色
- [ ] 反转后数据正确

### ✅ 11. 事件通知

#### change 事件
- [ ] 绘制结束时触发 change 事件
- [ ] 事件包含 dataURL
- [ ] 事件包含 imageData
- [ ] 清除时触发 change 事件
- [ ] 反转时触发 change 事件
- [ ] 填充时触发 change 事件

---

## 性能测试

### ✅ 1. 绘制性能

- [ ] 快速绘制不卡顿
- [ ] 大画笔绘制流畅
- [ ] 连续绘制无延迟
- [ ] CPU 使用率合理

### ✅ 2. 填充性能

- [ ] 小区域填充瞬间完成
- [ ] 中等区域填充 < 1 秒
- [ ] 大区域填充 < 3 秒
- [ ] 全画布填充 < 5 秒

### ✅ 3. 内存使用

- [ ] 长时间使用无内存泄漏
- [ ] 多次清除/重绘内存稳定
- [ ] 切换工具内存稳定

---

## 兼容性测试

### ✅ 1. 浏览器兼容性

#### Chrome
- [ ] 所有功能正常
- [ ] 性能良好
- [ ] 无控制台错误

#### Firefox
- [ ] 所有功能正常
- [ ] 性能良好
- [ ] 无控制台错误

#### Safari
- [ ] 所有功能正常
- [ ] 性能良好
- [ ] 无控制台错误

#### Edge
- [ ] 所有功能正常
- [ ] 性能良好
- [ ] 无控制台错误

### ✅ 2. 设备兼容性

#### 桌面端
- [ ] 鼠标操作正常
- [ ] 键盘快捷键正常
- [ ] 界面布局合理

#### 平板
- [ ] 触摸操作正常
- [ ] 界面适配良好
- [ ] 画笔大小适合触摸

#### 手机
- [ ] 触摸操作正常
- [ ] 界面适配良好
- [ ] 画笔大小适合触摸
- [ ] 横屏/竖屏都正常

---

## 集成测试

### ✅ 1. 与 InpaintingPanel 集成

- [ ] 在 InpaintingPanel 中正常渲染
- [ ] 蒙版数据正确传递
- [ ] 与其他组件无冲突
- [ ] 样式正确应用

### ✅ 2. Props 传递

- [ ] width 属性正确应用
- [ ] height 属性正确应用
- [ ] sourceImage 属性正确应用
- [ ] tool 属性正确应用
- [ ] brushSize 属性正确应用
- [ ] brushHardness 属性正确应用

### ✅ 3. 双向绑定

- [ ] bind:this 正确工作
- [ ] bind:tool 正确工作
- [ ] bind:brushSize 正确工作
- [ ] bind:brushHardness 正确工作

---

## 边界情况测试

### ✅ 1. 极端尺寸

- [ ] 最小尺寸（64x64）正常工作
- [ ] 最大尺寸（2048x2048）正常工作
- [ ] 非正方形尺寸正常工作
- [ ] 动态改变尺寸正常工作

### ✅ 2. 极端参数

- [ ] 画笔大小 5px 正常工作
- [ ] 画笔大小 100px 正常工作
- [ ] 画笔硬度 0.1 正常工作
- [ ] 画笔硬度 1.0 正常工作

### ✅ 3. 异常输入

- [ ] 无源图像时正常工作
- [ ] 源图像加载失败时正常处理
- [ ] 无效 Data URL 时正常处理

---

## 用户体验测试

### ✅ 1. 视觉反馈

- [ ] 当前工具清晰标识
- [ ] 画笔大小实时显示
- [ ] 蒙版区域清晰可见
- [ ] 按钮状态明确

### ✅ 2. 操作流畅性

- [ ] 工具切换即时响应
- [ ] 参数调整即时生效
- [ ] 绘制无延迟感
- [ ] 界面不卡顿

### ✅ 3. 提示信息

- [ ] 快捷键提示清晰
- [ ] 工具提示（tooltip）正确
- [ ] 参数说明清晰

---

## 回归测试

在每次修改后，重新运行以下核心测试：

1. [ ] 画笔绘制基本功能
2. [ ] 橡皮擦基本功能
3. [ ] 填充基本功能
4. [ ] 清除和反转功能
5. [ ] 键盘快捷键
6. [ ] 公开方法调用
7. [ ] change 事件触发

---

## 测试结果记录

### 测试日期: ___________
### 测试人员: ___________
### 浏览器版本: ___________
### 设备信息: ___________

### 通过的测试: _____ / _____
### 失败的测试: _____
### 阻塞问题: _____

### 备注:
```
[在此记录测试过程中发现的问题和建议]
```

---

## 已知问题

1. **填充工具性能** - 在超大图像（>2048x2048）上填充可能较慢
2. **触摸设备画笔大小** - 默认画笔大小可能对手指操作偏小
3. **Safari 画笔硬度** - Safari 上画笔硬度渲染可能略有差异

---

## 测试工具

### 手动测试
- 使用 MaskEditor.example.svelte 进行交互式测试
- 在不同浏览器和设备上测试

### 自动化测试（未来）
- 使用 Vitest 进行单元测试
- 使用 Playwright 进行 E2E 测试

---

## 测试通过标准

- ✅ 所有核心功能测试通过
- ✅ 至少在 2 个主流浏览器上测试通过
- ✅ 桌面端和移动端都测试通过
- ✅ 无阻塞性 bug
- ✅ 性能满足要求
- ✅ 用户体验良好

---

**文档版本**: 1.0  
**创建日期**: 2025-11-17  
**维护者**: AI Assistant
