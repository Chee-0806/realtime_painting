var pt=Object.defineProperty;var _t=(r,e,t)=>e in r?pt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var Ge=(r,e,t)=>(_t(r,typeof e!="symbol"?e+"":e,t),t);import{s as Ne,e as pe,i as H,C as te,d as p,f as h,a as I,g as v,h as D,u as J,c as x,j as i,v as n,w as X,M as gt,A as Re,E as ft,l as q,m as O,G as mt,B as Et,n as $,K as ze,H as Je,D as Qe,o as bt}from"./scheduler.ae4f2bff.js";import{e as ae,u as Ct,o as Ft}from"./each.fa7c727b.js";import{S as we,i as Ie,g as Dt,c as kt,a as ht,t as vt,b as yt,d as Bt,m as At,e as Nt}from"./index.92b2b836.js";import{e as wt,c as Be,E as U,s as Ae}from"./ModelManager.36413409.js";function Xe(r,e,t){const l=r.slice();return l[7]=e[t],l}function Ye(r){let e,t,l,u,s="âŒ¨ï¸ å¿«æ·é”®",a,o,f="âœ•",E,d,g,c,_,F="å…³é—­",k,V,L=ae(r[1]),b=[];for(let A=0;A<L.length;A+=1)b[A]=Ze(Xe(r,L,A));return{c(){e=h("div"),t=h("div"),l=h("div"),u=h("h2"),u.textContent=s,a=I(),o=h("button"),o.textContent=f,E=I(),d=h("div");for(let A=0;A<b.length;A+=1)b[A].c();g=I(),c=h("div"),_=h("button"),_.textContent=F,this.h()},l(A){e=v(A,"DIV",{class:!0,role:!0,"aria-modal":!0,"aria-labelledby":!0});var j=D(e);t=v(j,"DIV",{class:!0,role:!0});var N=D(t);l=v(N,"DIV",{class:!0});var M=D(l);u=v(M,"H2",{id:!0,class:!0,"data-svelte-h":!0}),J(u)!=="svelte-166uzre"&&(u.textContent=s),a=x(M),o=v(M,"BUTTON",{class:!0,type:!0,"aria-label":!0,"data-svelte-h":!0}),J(o)!=="svelte-1xeeokb"&&(o.textContent=f),M.forEach(p),E=x(N),d=v(N,"DIV",{class:!0});var w=D(d);for(let C=0;C<b.length;C+=1)b[C].l(w);w.forEach(p),g=x(N),c=v(N,"DIV",{class:!0});var B=D(c);_=v(B,"BUTTON",{class:!0,type:!0,"data-svelte-h":!0}),J(_)!=="svelte-1jm07t9"&&(_.textContent=F),B.forEach(p),N.forEach(p),j.forEach(p),this.h()},h(){i(u,"id","shortcuts-title"),i(u,"class","title"),i(o,"class","btn-ghost"),i(o,"type","button"),i(o,"aria-label","å…³é—­"),i(l,"class","flex items-center justify-between mb-6"),i(d,"class","space-y-4"),i(_,"class","btn-secondary w-full"),i(_,"type","button"),i(c,"class","mt-6 pt-4 border-t border-border"),i(t,"class","card max-w-2xl w-full mx-4 max-h-[80vh] overflow-y-auto"),i(t,"role","document"),i(e,"class","fixed inset-0 z-50 flex items-center justify-center bg-black/50"),i(e,"role","dialog"),i(e,"aria-modal","true"),i(e,"aria-labelledby","shortcuts-title")},m(A,j){H(A,e,j),n(e,t),n(t,l),n(l,u),n(l,a),n(l,o),n(t,E),n(t,d);for(let N=0;N<b.length;N+=1)b[N]&&b[N].m(d,null);n(t,g),n(t,c),n(c,_),k||(V=[X(o,"click",r[3]),X(_,"click",r[4]),X(t,"click",gt(r[2])),X(e,"click",r[5]),X(e,"keydown",r[6])],k=!0)},p(A,j){if(j&2){L=ae(A[1]);let N;for(N=0;N<L.length;N+=1){const M=Xe(A,L,N);b[N]?b[N].p(M,j):(b[N]=Ze(M),b[N].c(),b[N].m(d,null))}for(;N<b.length;N+=1)b[N].d(1);b.length=L.length}},d(A){A&&p(e),Re(b,A),k=!1,ft(V)}}}function Ze(r){let e,t,l=r[7].description+"",u,s,a,o=r[7].key+"",f,E;return{c(){e=h("div"),t=h("span"),u=q(l),s=I(),a=h("kbd"),f=q(o),E=I(),this.h()},l(d){e=v(d,"DIV",{class:!0});var g=D(e);t=v(g,"SPAN",{class:!0});var c=D(t);u=O(c,l),c.forEach(p),s=x(g),a=v(g,"KBD",{class:!0});var _=D(a);f=O(_,o),_.forEach(p),E=x(g),g.forEach(p),this.h()},h(){i(t,"class","text-text-secondary"),i(a,"class","px-3 py-1 bg-surface-elevated border border-border rounded-lg text-sm font-mono text-text-primary"),i(e,"class","flex items-center justify-between py-2 border-b border-border")},m(d,g){H(d,e,g),n(e,t),n(t,u),n(e,s),n(e,a),n(a,f),n(e,E)},p:te,d(d){d&&p(e)}}}function It(r){let e,t=r[0]&&Ye(r);return{c(){t&&t.c(),e=pe()},l(l){t&&t.l(l),e=pe()},m(l,u){t&&t.m(l,u),H(l,e,u)},p(l,[u]){l[0]?t?t.p(l,u):(t=Ye(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:te,o:te,d(l){l&&p(e),t&&t.d(l)}}}function xt(r,e,t){let{show:l=!1}=e;const u=[{key:"Shift + ?",description:"æ˜¾ç¤º/éšè—å¿«æ·é”®å¸®åŠ©"}];function s(d){mt.call(this,r,d)}const a=()=>t(0,l=!1),o=()=>t(0,l=!1),f=()=>t(0,l=!1),E=d=>{d.key==="Escape"&&t(0,l=!1)};return r.$$set=d=>{"show"in d&&t(0,l=d.show)},[l,u,s,a,o,f,E]}class zt extends we{constructor(e){super(),Ie(this,e,xt,It,Ne,{show:0})}}function $e(r,e,t){const l=r.slice();return l[8]=e[t],l}function et(r){let e,t,l,u,s,a,o,f,E,d,g,c,_='<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>',F,k,V=r[0].error.message+"",L,b,A,j,N,M,w=r[0].error.details&&tt(r),B=r[3].length>0&&lt(r),C=r[0].error.recoverable&&ut(r);return{c(){e=h("div"),t=h("div"),l=h("div"),u=h("span"),s=q(r[2]),a=I(),o=h("div"),f=h("div"),E=h("h4"),d=q(r[1]),g=I(),c=h("button"),c.innerHTML=_,F=I(),k=h("p"),L=q(V),b=I(),w&&w.c(),A=I(),B&&B.c(),j=I(),C&&C.c(),this.h()},l(m){e=v(m,"DIV",{class:!0});var y=D(e);t=v(y,"DIV",{class:!0});var R=D(t);l=v(R,"DIV",{class:!0});var Q=D(l);u=v(Q,"SPAN",{class:!0});var z=D(u);s=O(z,r[2]),z.forEach(p),a=x(Q),o=v(Q,"DIV",{class:!0});var S=D(o);f=v(S,"DIV",{class:!0});var le=D(f);E=v(le,"H4",{class:!0});var ce=D(E);d=O(ce,r[1]),ce.forEach(p),g=x(le),c=v(le,"BUTTON",{class:!0,"aria-label":!0,"data-svelte-h":!0}),J(c)!=="svelte-146heoo"&&(c.innerHTML=_),le.forEach(p),F=x(S),k=v(S,"P",{class:!0});var ee=D(k);L=O(ee,V),ee.forEach(p),b=x(S),w&&w.l(S),A=x(S),B&&B.l(S),j=x(S),C&&C.l(S),S.forEach(p),Q.forEach(p),R.forEach(p),y.forEach(p),this.h()},h(){i(u,"class","text-2xl flex-shrink-0"),i(E,"class","font-semibold text-red-800"),i(c,"class","text-red-500 hover:text-red-700 transition-colors flex-shrink-0"),i(c,"aria-label","å…³é—­é”™è¯¯æç¤º"),i(f,"class","flex items-start justify-between gap-2 mb-2"),i(k,"class","text-red-700 text-sm mb-2"),i(o,"class","flex-1 min-w-0"),i(l,"class","flex items-start gap-3"),i(t,"class","bg-red-50 border-l-4 border-red-500 rounded-lg shadow-lg p-4"),i(e,"class","fixed top-4 right-4 z-50 max-w-md animate-slide-in svelte-1b6tmen")},m(m,y){H(m,e,y),n(e,t),n(t,l),n(l,u),n(u,s),n(l,a),n(l,o),n(o,f),n(f,E),n(E,d),n(f,g),n(f,c),n(o,F),n(o,k),n(k,L),n(o,b),w&&w.m(o,null),n(o,A),B&&B.m(o,null),n(o,j),C&&C.m(o,null),N||(M=X(c,"click",r[4]),N=!0)},p(m,y){y&4&&$(s,m[2]),y&2&&$(d,m[1]),y&1&&V!==(V=m[0].error.message+"")&&$(L,V),m[0].error.details?w?w.p(m,y):(w=tt(m),w.c(),w.m(o,A)):w&&(w.d(1),w=null),m[3].length>0?B?B.p(m,y):(B=lt(m),B.c(),B.m(o,j)):B&&(B.d(1),B=null),m[0].error.recoverable?C?C.p(m,y):(C=ut(m),C.c(),C.m(o,null)):C&&(C.d(1),C=null)},d(m){m&&p(e),w&&w.d(),B&&B.d(),C&&C.d(),N=!1,M()}}}function tt(r){let e,t=r[0].error.details+"",l;return{c(){e=h("p"),l=q(t),this.h()},l(u){e=v(u,"P",{class:!0});var s=D(e);l=O(s,t),s.forEach(p),this.h()},h(){i(e,"class","text-red-600 text-xs mb-3 font-mono bg-red-100 p-2 rounded")},m(u,s){H(u,e,s),n(e,l)},p(u,s){s&1&&t!==(t=u[0].error.details+"")&&$(l,t)},d(u){u&&p(e)}}}function lt(r){let e,t,l="ğŸ’¡ å»ºè®®:",u,s,a=ae(r[3]),o=[];for(let f=0;f<a.length;f+=1)o[f]=st($e(r,a,f));return{c(){e=h("div"),t=h("p"),t.textContent=l,u=I(),s=h("ul");for(let f=0;f<o.length;f+=1)o[f].c();this.h()},l(f){e=v(f,"DIV",{class:!0});var E=D(e);t=v(E,"P",{class:!0,"data-svelte-h":!0}),J(t)!=="svelte-9nlrif"&&(t.textContent=l),u=x(E),s=v(E,"UL",{class:!0});var d=D(s);for(let g=0;g<o.length;g+=1)o[g].l(d);d.forEach(p),E.forEach(p),this.h()},h(){i(t,"class","text-xs font-semibold text-red-800 mb-2"),i(s,"class","text-xs text-red-700 space-y-1"),i(e,"class","mt-3 pt-3 border-t border-red-200")},m(f,E){H(f,e,E),n(e,t),n(e,u),n(e,s);for(let d=0;d<o.length;d+=1)o[d]&&o[d].m(s,null)},p(f,E){if(E&8){a=ae(f[3]);let d;for(d=0;d<a.length;d+=1){const g=$e(f,a,d);o[d]?o[d].p(g,E):(o[d]=st(g),o[d].c(),o[d].m(s,null))}for(;d<o.length;d+=1)o[d].d(1);o.length=a.length}},d(f){f&&p(e),Re(o,f)}}}function st(r){let e,t,l="â€¢",u,s,a=r[8]+"",o,f;return{c(){e=h("li"),t=h("span"),t.textContent=l,u=I(),s=h("span"),o=q(a),f=I(),this.h()},l(E){e=v(E,"LI",{class:!0});var d=D(e);t=v(d,"SPAN",{class:!0,"data-svelte-h":!0}),J(t)!=="svelte-1rlqugl"&&(t.textContent=l),u=x(d),s=v(d,"SPAN",{});var g=D(s);o=O(g,a),g.forEach(p),f=x(d),d.forEach(p),this.h()},h(){i(t,"class","text-red-400 flex-shrink-0"),i(e,"class","flex items-start gap-2")},m(E,d){H(E,e,d),n(e,t),n(e,u),n(e,s),n(s,o),n(e,f)},p(E,d){d&8&&a!==(a=E[8]+"")&&$(o,a)},d(E){E&&p(e)}}}function ut(r){let e,t,l="æˆ‘çŸ¥é“äº†",u,s;return{c(){e=h("div"),t=h("button"),t.textContent=l,this.h()},l(a){e=v(a,"DIV",{class:!0});var o=D(e);t=v(o,"BUTTON",{class:!0,"data-svelte-h":!0}),J(t)!=="svelte-153fhqe"&&(t.textContent=l),o.forEach(p),this.h()},h(){i(t,"class","text-xs bg-red-500 hover:bg-red-600 text-white px-3 py-1.5 rounded transition-colors"),i(e,"class","mt-3 pt-3 border-t border-red-200")},m(a,o){H(a,e,o),n(e,t),u||(s=X(t,"click",r[4]),u=!0)},p:te,d(a){a&&p(e),u=!1,s()}}}function Tt(r){let e,t=r[0].hasError&&r[0].error&&et(r);return{c(){t&&t.c(),e=pe()},l(l){t&&t.l(l),e=pe()},m(l,u){t&&t.m(l,u),H(l,e,u)},p(l,[u]){l[0].hasError&&l[0].error?t?t.p(l,u):(t=et(l),t.c(),t.m(e.parentNode,e)):t&&(t.d(1),t=null)},i:te,o:te,d(l){l&&p(e),t&&t.d(l)}}}function Lt(r,e,t){let l,u,s,a;Et(r,wt,g=>t(0,a=g));function o(){Be()}function f(g){if(g.suggestions&&g.suggestions.length>0)return g.suggestions;switch(g.type){case U.MODEL:return["æ£€æŸ¥æ¨¡å‹è·¯å¾„æ˜¯å¦æ­£ç¡®","ç¡®ä¿æœ‰è¶³å¤Ÿçš„æ˜¾å­˜","å°è¯•é‡å¯æœåŠ¡"];case U.WEBSOCKET:return["æ£€æŸ¥ç½‘ç»œè¿æ¥","åˆ·æ–°é¡µé¢é‡æ–°è¿æ¥","æŸ¥çœ‹åç«¯æ—¥å¿—"];case U.NETWORK:return["æ£€æŸ¥ç½‘ç»œè¿æ¥","ç¡®è®¤åç«¯æœåŠ¡æ­£åœ¨è¿è¡Œ","æ£€æŸ¥é˜²ç«å¢™è®¾ç½®"];case U.API:return["æ£€æŸ¥è¯·æ±‚å‚æ•°æ˜¯å¦æ­£ç¡®","æŸ¥çœ‹åç«¯æ—¥å¿—è·å–è¯¦ç»†ä¿¡æ¯","å°è¯•é‡æ–°æäº¤è¯·æ±‚"];case U.VALIDATION:return["æ£€æŸ¥è¾“å…¥å‚æ•°æ˜¯å¦ç¬¦åˆè¦æ±‚","ç¡®ä¿æ‰€æœ‰å¿…å¡«å­—æ®µå·²å¡«å†™","å‚è€ƒæ–‡æ¡£äº†è§£å‚æ•°èŒƒå›´"];case U.GENERATION:return["å°è¯•è°ƒæ•´ç”Ÿæˆå‚æ•°","æ£€æŸ¥Promptæ˜¯å¦åˆç†","ç¡®ä¿æ¨¡å‹å·²æ­£ç¡®åŠ è½½"];default:return["è¯·é‡è¯•æˆ–è”ç³»æŠ€æœ¯æ”¯æŒ"]}}function E(g){switch(g){case U.MODEL:return"ğŸ¨";case U.WEBSOCKET:return"ğŸ”Œ";case U.NETWORK:return"ğŸŒ";case U.API:return"âš™ï¸";case U.VALIDATION:return"âœï¸";case U.GENERATION:return"ğŸ–¼ï¸";default:return"âš ï¸"}}function d(g){switch(g){case U.MODEL:return"æ¨¡å‹é”™è¯¯";case U.WEBSOCKET:return"WebSocketè¿æ¥é”™è¯¯";case U.NETWORK:return"ç½‘ç»œé”™è¯¯";case U.API:return"APIé”™è¯¯";case U.VALIDATION:return"å‚æ•°éªŒè¯é”™è¯¯";case U.GENERATION:return"ç”Ÿæˆé”™è¯¯";default:return"é”™è¯¯"}}return r.$$.update=()=>{r.$$.dirty&1&&t(3,l=a.error?f(a.error):[]),r.$$.dirty&1&&t(2,u=a.error?E(a.error.type):"âš ï¸"),r.$$.dirty&1&&t(1,s=a.error?d(a.error.type):"é”™è¯¯")},[a,s,u,l,o]}class Jt extends we{constructor(e){super(),Ie(this,e,Lt,Tt,Ne,{})}}function rt(r,e,t){const l=r.slice();return l[11]=e[t],l}function nt(r){let e,t=r[11]+"",l,u;return{c(){e=h("option"),l=q(t),this.h()},l(s){e=v(s,"OPTION",{});var a=D(e);l=O(a,t),a.forEach(p),this.h()},h(){e.__value=u=r[11],Je(e,e.__value)},m(s,a){H(s,e,a),n(e,l)},p(s,a){a&4&&t!==(t=s[11]+"")&&$(l,t),a&4&&u!==(u=s[11])&&(e.__value=u,Je(e,e.__value))},d(s){s&&p(e)}}}function at(r){let e,t,l;return{c(){e=h("div"),t=h("img"),this.h()},l(u){e=v(u,"DIV",{class:!0});var s=D(e);t=v(s,"IMG",{src:!0,alt:!0,class:!0}),s.forEach(p),this.h()},h(){Qe(t.src,l=r[0].image)||i(t,"src",l),i(t,"alt","ControlNeté¢„è§ˆ"),i(t,"class","preview-img svelte-1qb8otk"),i(e,"class","image-preview svelte-1qb8otk")},m(u,s){H(u,e,s),n(e,t)},p(u,s){s&5&&!Qe(t.src,l=u[0].image)&&i(t,"src",l)},d(u){u&&p(e)}}}function Vt(r){let e,t,l,u,s=r[1]+1+"",a,o,f,E="âœ•",d,g,c,_="ç±»å‹",F,k,V,L,b,A,j="æ§åˆ¶å›¾åƒ",N,M,w,B,C,m,y,R=r[0].weight.toFixed(2)+"",Q,z,S,le,ce,ee,je="<span>0.0</span> <span>1.0</span> <span>2.0</span>",xe,ue,re,oe,Te,_e=r[0].guidanceStart.toFixed(2)+"",me,Le,Y,Ee,Ve,ne,ie,Se,ge=r[0].guidanceEnd.toFixed(2)+"",be,qe,Z,Ce,Oe,He,de=ae(r[2]),W=[];for(let T=0;T<de.length;T+=1)W[T]=nt(rt(r,de,T));let G=r[0].image&&at(r);return{c(){e=h("div"),t=h("div"),l=h("h4"),u=q("ControlNet "),a=q(s),o=I(),f=h("button"),f.textContent=E,d=I(),g=h("div"),c=h("label"),c.textContent=_,F=I(),k=h("select");for(let T=0;T<W.length;T+=1)W[T].c();L=I(),b=h("div"),A=h("label"),A.textContent=j,N=I(),M=h("input"),w=I(),G&&G.c(),B=I(),C=h("div"),m=h("label"),y=q("æƒé‡: "),Q=q(R),z=I(),S=h("input"),ce=I(),ee=h("div"),ee.innerHTML=je,xe=I(),ue=h("div"),re=h("div"),oe=h("label"),Te=q("å¼•å¯¼å¼€å§‹: "),me=q(_e),Le=I(),Y=h("input"),Ve=I(),ne=h("div"),ie=h("label"),Se=q("å¼•å¯¼ç»“æŸ: "),be=q(ge),qe=I(),Z=h("input"),this.h()},l(T){e=v(T,"DIV",{class:!0});var P=D(e);t=v(P,"DIV",{class:!0});var K=D(t);l=v(K,"H4",{class:!0});var fe=D(l);u=O(fe,"ControlNet "),a=O(fe,s),fe.forEach(p),o=x(K),f=v(K,"BUTTON",{class:!0,title:!0,"data-svelte-h":!0}),J(f)!=="svelte-pg95ho"&&(f.textContent=E),K.forEach(p),d=x(P),g=v(P,"DIV",{class:!0});var Fe=D(g);c=v(Fe,"LABEL",{class:!0,"data-svelte-h":!0}),J(c)!=="svelte-1yhp6bx"&&(c.textContent=_),F=x(Fe),k=v(Fe,"SELECT",{class:!0});var We=D(k);for(let Ue=0;Ue<W.length;Ue+=1)W[Ue].l(We);We.forEach(p),Fe.forEach(p),L=x(P),b=v(P,"DIV",{class:!0});var he=D(b);A=v(he,"LABEL",{class:!0,"data-svelte-h":!0}),J(A)!=="svelte-1f070vx"&&(A.textContent=j),N=x(he),M=v(he,"INPUT",{type:!0,accept:!0,class:!0}),w=x(he),G&&G.l(he),he.forEach(p),B=x(P),C=v(P,"DIV",{class:!0});var ve=D(C);m=v(ve,"LABEL",{class:!0});var Pe=D(m);y=O(Pe,"æƒé‡: "),Q=O(Pe,R),Pe.forEach(p),z=x(ve),S=v(ve,"INPUT",{type:!0,min:!0,max:!0,step:!0,class:!0}),ce=x(ve),ee=v(ve,"DIV",{class:!0,"data-svelte-h":!0}),J(ee)!=="svelte-5pwyju"&&(ee.innerHTML=je),ve.forEach(p),xe=x(P),ue=v(P,"DIV",{class:!0});var De=D(ue);re=v(De,"DIV",{class:!0});var ke=D(re);oe=v(ke,"LABEL",{class:!0});var Me=D(oe);Te=O(Me,"å¼•å¯¼å¼€å§‹: "),me=O(Me,_e),Me.forEach(p),Le=x(ke),Y=v(ke,"INPUT",{type:!0,min:!0,max:!0,step:!0,class:!0}),ke.forEach(p),Ve=x(De),ne=v(De,"DIV",{class:!0});var ye=D(ne);ie=v(ye,"LABEL",{class:!0});var Ke=D(ie);Se=O(Ke,"å¼•å¯¼ç»“æŸ: "),be=O(Ke,ge),Ke.forEach(p),qe=x(ye),Z=v(ye,"INPUT",{type:!0,min:!0,max:!0,step:!0,class:!0}),ye.forEach(p),De.forEach(p),P.forEach(p),this.h()},h(){i(l,"class","title svelte-1qb8otk"),i(f,"class","btn-remove svelte-1qb8otk"),i(f,"title","åˆ é™¤æ­¤ControlNet"),i(t,"class","header svelte-1qb8otk"),i(c,"class","label svelte-1qb8otk"),i(k,"class","input svelte-1qb8otk"),i(g,"class","field svelte-1qb8otk"),i(A,"class","label svelte-1qb8otk"),i(M,"type","file"),i(M,"accept","image/*"),i(M,"class","input svelte-1qb8otk"),i(b,"class","field svelte-1qb8otk"),i(m,"class","label svelte-1qb8otk"),i(S,"type","range"),i(S,"min","0"),i(S,"max","2"),i(S,"step","0.1"),S.value=le=r[0].weight,i(S,"class","slider svelte-1qb8otk"),i(ee,"class","slider-labels svelte-1qb8otk"),i(C,"class","field svelte-1qb8otk"),i(oe,"class","label svelte-1qb8otk"),i(Y,"type","range"),i(Y,"min","0"),i(Y,"max","1"),i(Y,"step","0.05"),Y.value=Ee=r[0].guidanceStart,i(Y,"class","slider svelte-1qb8otk"),i(re,"class","field svelte-1qb8otk"),i(ie,"class","label svelte-1qb8otk"),i(Z,"type","range"),i(Z,"min","0"),i(Z,"max","1"),i(Z,"step","0.05"),Z.value=Ce=r[0].guidanceEnd,i(Z,"class","slider svelte-1qb8otk"),i(ne,"class","field svelte-1qb8otk"),i(ue,"class","guidance-range svelte-1qb8otk"),i(e,"class","controlnet-item svelte-1qb8otk")},m(T,P){H(T,e,P),n(e,t),n(t,l),n(l,u),n(l,a),n(t,o),n(t,f),n(e,d),n(e,g),n(g,c),n(g,F),n(g,k);for(let K=0;K<W.length;K+=1)W[K]&&W[K].m(k,null);ze(k,r[0].type),n(e,L),n(e,b),n(b,A),n(b,N),n(b,M),n(b,w),G&&G.m(b,null),n(e,B),n(e,C),n(C,m),n(m,y),n(m,Q),n(C,z),n(C,S),n(C,ce),n(C,ee),n(e,xe),n(e,ue),n(ue,re),n(re,oe),n(oe,Te),n(oe,me),n(re,Le),n(re,Y),n(ue,Ve),n(ue,ne),n(ne,ie),n(ie,Se),n(ie,be),n(ne,qe),n(ne,Z),Oe||(He=[X(f,"click",r[8]),X(k,"change",r[4]),X(M,"change",r[3]),X(S,"input",r[5]),X(Y,"input",r[6]),X(Z,"input",r[7])],Oe=!0)},p(T,[P]){if(P&2&&s!==(s=T[1]+1+"")&&$(a,s),P&4){de=ae(T[2]);let K;for(K=0;K<de.length;K+=1){const fe=rt(T,de,K);W[K]?W[K].p(fe,P):(W[K]=nt(fe),W[K].c(),W[K].m(k,null))}for(;K<W.length;K+=1)W[K].d(1);W.length=de.length}P&5&&V!==(V=T[0].type)&&ze(k,T[0].type),T[0].image?G?G.p(T,P):(G=at(T),G.c(),G.m(b,null)):G&&(G.d(1),G=null),P&1&&R!==(R=T[0].weight.toFixed(2)+"")&&$(Q,R),P&5&&le!==(le=T[0].weight)&&(S.value=le),P&1&&_e!==(_e=T[0].guidanceStart.toFixed(2)+"")&&$(me,_e),P&5&&Ee!==(Ee=T[0].guidanceStart)&&(Y.value=Ee),P&1&&ge!==(ge=T[0].guidanceEnd.toFixed(2)+"")&&$(be,ge),P&5&&Ce!==(Ce=T[0].guidanceEnd)&&(Z.value=Ce)},i:te,o:te,d(T){T&&p(e),Re(W,T),G&&G.d(),Oe=!1,ft(He)}}}function St(r,e,t){let{config:l}=e,{index:u}=e,{availableTypes:s=["canny","depth","pose","scribble","lineart","normal","semantic"]}=e,{onRemove:a=()=>{}}=e,{onUpdate:o=()=>{}}=e;function f(F){var b;const V=(b=F.target.files)==null?void 0:b[0];if(!V)return;if(!V.type.startsWith("image/")){Ae({type:U.VALIDATION,message:"è¯·é€‰æ‹©å›¾åƒæ–‡ä»¶",details:"åªæ”¯æŒå›¾åƒæ ¼å¼ï¼ˆPNG, JPG, WebPç­‰ï¼‰",recoverable:!0,suggestions:["é€‰æ‹©ä¸€ä¸ªæœ‰æ•ˆçš„å›¾åƒæ–‡ä»¶"]});return}const L=new FileReader;L.onload=A=>{var N;const j=(N=A.target)==null?void 0:N.result;o(l.id,"image",j),Be()},L.onerror=()=>{Ae({type:U.VALIDATION,message:"å›¾åƒåŠ è½½å¤±è´¥",details:"æ— æ³•è¯»å–é€‰æ‹©çš„æ–‡ä»¶",recoverable:!0,suggestions:["å°è¯•é€‰æ‹©å…¶ä»–å›¾åƒæ–‡ä»¶"]})},L.readAsDataURL(V)}function E(F){const k=F.target;o(l.id,"type",k.value)}function d(F){const k=F.target;o(l.id,"weight",parseFloat(k.value))}function g(F){const k=F.target;o(l.id,"guidanceStart",parseFloat(k.value))}function c(F){const k=F.target;o(l.id,"guidanceEnd",parseFloat(k.value))}function _(){a(l.id)}return r.$$set=F=>{"config"in F&&t(0,l=F.config),"index"in F&&t(1,u=F.index),"availableTypes"in F&&t(2,s=F.availableTypes),"onRemove"in F&&t(9,a=F.onRemove),"onUpdate"in F&&t(10,o=F.onUpdate)},[l,u,s,f,E,d,g,c,_,a,o]}class qt extends we{constructor(e){super(),Ie(this,e,St,Vt,Ne,{config:0,index:1,availableTypes:2,onRemove:9,onUpdate:10})}}function ot(r,e,t){const l=r.slice();return l[9]=e[t],l[11]=t,l}function it(r,e){let t,l,u;return l=new qt({props:{config:e[9],index:e[11],availableTypes:e[1],onRemove:e[4],onUpdate:e[5]}}),{key:r,first:null,c(){t=pe(),yt(l.$$.fragment),this.h()},l(s){t=pe(),Bt(l.$$.fragment,s),this.h()},h(){this.first=t},m(s,a){H(s,t,a),At(l,s,a),u=!0},p(s,a){e=s;const o={};a&1&&(o.config=e[9]),a&1&&(o.index=e[11]),a&2&&(o.availableTypes=e[1]),l.$set(o)},i(s){u||(ht(l.$$.fragment,s),u=!0)},o(s){vt(l.$$.fragment,s),u=!1},d(s){s&&p(t),Nt(l,s)}}}function Ot(r){let e,t,l,u;return{c(){e=h("div"),t=q("å·²è¾¾åˆ°æœ€å¤§æ•°é‡ï¼ˆ"),l=q(se),u=q("ä¸ªï¼‰"),this.h()},l(s){e=v(s,"DIV",{class:!0});var a=D(e);t=O(a,"å·²è¾¾åˆ°æœ€å¤§æ•°é‡ï¼ˆ"),l=O(a,se),u=O(a,"ä¸ªï¼‰"),a.forEach(p),this.h()},h(){i(e,"class","text-center text-sm text-text-secondary p-2")},m(s,a){H(s,e,a),n(e,t),n(e,l),n(e,u)},p:te,d(s){s&&p(e)}}}function Pt(r){let e,t,l,u;return{c(){e=h("button"),t=q("+ æ·»åŠ ControlNet"),this.h()},l(s){e=v(s,"BUTTON",{class:!0});var a=D(e);t=O(a,"+ æ·»åŠ ControlNet"),a.forEach(p),this.h()},h(){i(e,"class","btn-secondary w-full svelte-ri1pfc"),e.disabled=r[2]},m(s,a){H(s,e,a),n(e,t),l||(u=X(e,"click",r[3]),l=!0)},p(s,a){a&4&&(e.disabled=s[2])},d(s){s&&p(e),l=!1,u()}}}function ct(r){let e,t,l="ğŸ®",u,s,a="è¿˜æ²¡æœ‰æ·»åŠ ControlNet",o,f,E,d,g;return{c(){e=h("div"),t=h("div"),t.textContent=l,u=I(),s=h("p"),s.textContent=a,o=I(),f=h("p"),E=q("ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ æœ€å¤š"),d=q(se),g=q("ä¸ªControlNet"),this.h()},l(c){e=v(c,"DIV",{class:!0});var _=D(e);t=v(_,"DIV",{class:!0,"data-svelte-h":!0}),J(t)!=="svelte-wux1gh"&&(t.textContent=l),u=x(_),s=v(_,"P",{class:!0,"data-svelte-h":!0}),J(s)!=="svelte-6qhvpu"&&(s.textContent=a),o=x(_),f=v(_,"P",{class:!0});var F=D(f);E=O(F,"ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®æ·»åŠ æœ€å¤š"),d=O(F,se),g=O(F,"ä¸ªControlNet"),F.forEach(p),_.forEach(p),this.h()},h(){i(t,"class","text-4xl mb-2"),i(s,"class","text-sm"),i(f,"class","text-xs mt-1"),i(e,"class","text-center py-8 text-text-secondary")},m(c,_){H(c,e,_),n(e,t),n(e,u),n(e,s),n(e,o),n(e,f),n(f,E),n(f,d),n(f,g)},p:te,d(c){c&&p(e)}}}function dt(r){let e,t='<div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-primary"></div> <p class="text-sm text-text-secondary mt-2">æ­£åœ¨ç”Ÿæˆ...</p>';return{c(){e=h("div"),e.innerHTML=t,this.h()},l(l){e=v(l,"DIV",{class:!0,"data-svelte-h":!0}),J(e)!=="svelte-6m0z42"&&(e.innerHTML=t),this.h()},h(){i(e,"class","text-center py-4")},m(l,u){H(l,e,u)},d(l){l&&p(e)}}}function Mt(r){let e,t,l,u="ğŸ® å¤šControlNetæ§åˆ¶",s,a,o=r[0].length+"",f,E,d,g,c,_=[],F=new Map,k,V,L,b,A=ae(r[0]);const j=m=>m[9].id;for(let m=0;m<A.length;m+=1){let y=ot(r,A,m),R=j(y);F.set(R,_[m]=it(R,y))}function N(m,y){return m[0].length<se?Pt:Ot}let M=N(r),w=M(r),B=r[0].length===0&&ct(),C=r[2]&&dt();return{c(){e=h("div"),t=h("div"),l=h("h3"),l.textContent=u,s=I(),a=h("span"),f=q(o),E=q(" / "),d=q(se),g=I(),c=h("div");for(let m=0;m<_.length;m+=1)_[m].c();k=I(),w.c(),V=I(),B&&B.c(),L=I(),C&&C.c(),this.h()},l(m){e=v(m,"DIV",{class:!0});var y=D(e);t=v(y,"DIV",{class:!0});var R=D(t);l=v(R,"H3",{class:!0,"data-svelte-h":!0}),J(l)!=="svelte-3ioe90"&&(l.textContent=u),s=x(R),a=v(R,"SPAN",{class:!0});var Q=D(a);f=O(Q,o),E=O(Q," / "),d=O(Q,se),Q.forEach(p),R.forEach(p),g=x(y),c=v(y,"DIV",{class:!0});var z=D(c);for(let S=0;S<_.length;S+=1)_[S].l(z);k=x(z),w.l(z),V=x(z),B&&B.l(z),L=x(z),C&&C.l(z),z.forEach(p),y.forEach(p),this.h()},h(){i(l,"class","heading svelte-ri1pfc"),i(a,"class","text-sm text-text-secondary"),i(t,"class","flex items-center justify-between mb-4"),i(c,"class","space-y-4"),i(e,"class","card svelte-ri1pfc")},m(m,y){H(m,e,y),n(e,t),n(t,l),n(t,s),n(t,a),n(a,f),n(a,E),n(a,d),n(e,g),n(e,c);for(let R=0;R<_.length;R+=1)_[R]&&_[R].m(c,null);n(c,k),w.m(c,null),n(c,V),B&&B.m(c,null),n(c,L),C&&C.m(c,null),b=!0},p(m,[y]){(!b||y&1)&&o!==(o=m[0].length+"")&&$(f,o),y&51&&(A=ae(m[0]),Dt(),_=Ct(_,y,j,1,m,A,F,c,Ft,it,k,ot),kt()),M===(M=N(m))&&w?w.p(m,y):(w.d(1),w=M(m),w&&(w.c(),w.m(c,V))),m[0].length===0?B?B.p(m,y):(B=ct(),B.c(),B.m(c,L)):B&&(B.d(1),B=null),m[2]?C||(C=dt(),C.c(),C.m(c,null)):C&&(C.d(1),C=null)},i(m){if(!b){for(let y=0;y<A.length;y+=1)ht(_[y]);b=!0}},o(m){for(let y=0;y<_.length;y+=1)vt(_[y]);b=!1},d(m){m&&p(e);for(let y=0;y<_.length;y+=1)_[y].d();w.d(),B&&B.d(),C&&C.d()}}}let se=3;function Kt(r,e,t){let{controlnets:l=[]}=e,u=[],s=!1;bt(async()=>{try{const c=await fetch("/api/controlnet/types");if(c.ok){const _=await c.json();_.success&&_.types?(t(1,u=_.types),console.log(`âœ… æˆåŠŸè·å–${_.types.length}ä¸ªControlNetç±»å‹:`,_.types)):(t(1,u=["canny","depth","pose","scribble","lineart","normal","semantic"]),console.warn("âš ï¸ åç«¯æœªè¿”å›ControlNetç±»å‹ï¼Œä½¿ç”¨é»˜è®¤åˆ—è¡¨"))}else t(1,u=["canny","depth","pose","scribble","lineart","normal","semantic"]),console.warn("âš ï¸ æ— æ³•è·å–ControlNetç±»å‹ï¼Œä½¿ç”¨é»˜è®¤åˆ—è¡¨")}catch(c){t(1,u=["canny","depth","pose","scribble","lineart","normal","semantic"]),console.error("âŒ è·å–ControlNetç±»å‹å¤±è´¥:",c)}});function a(){if(l.length>=se){Ae({type:U.VALIDATION,message:"å·²è¾¾åˆ°æœ€å¤§æ•°é‡",details:`æœ€å¤šåªèƒ½æ·»åŠ ${se}ä¸ªControlNet`,recoverable:!0,suggestions:["åˆ é™¤ç°æœ‰çš„ControlNetåå†æ·»åŠ "]});return}const c={id:`cn-${Date.now()}-${Math.random().toString(36).substr(2,9)}`,type:u[0]||"canny",image:"",weight:1,guidanceStart:0,guidanceEnd:1};t(0,l=[...l,c]),Be()}function o(c){t(0,l=l.filter(_=>_.id!==c))}function f(c,_,F){t(0,l=l.map(k=>k.id===c?{...k,[_]:F}:k))}function E(){return l.filter(c=>c.image!=="")}function d(){const c=l.filter(_=>_.image!=="");return l.length>0&&c.length===0?{valid:!1,message:"è¯·ä¸ºæ‰€æœ‰ControlNetä¸Šä¼ å›¾åƒ"}:{valid:!0}}async function g(c){const _=d();if(!_.valid)return{success:!1,message:_.message};const F=E();if(F.length===0)return{success:!1,message:"è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªControlNetå¹¶ä¸Šä¼ å›¾åƒ"};t(2,s=!0),Be();try{const k={prompt:c.prompt,negative_prompt:c.negative_prompt||"",controlnet_configs:F.map(b=>({type:b.type,image:b.image,weight:b.weight,guidance_start:b.guidanceStart,guidance_end:b.guidanceEnd})),num_inference_steps:c.num_inference_steps||20,guidance_scale:c.guidance_scale||7.5,height:c.height||512,width:c.width||512,seed:c.seed};console.log("ğŸš€ å‘é€å¤šControlNetç”Ÿæˆè¯·æ±‚:",{controlnet_count:F.length,types:F.map(b=>b.type),prompt:c.prompt});const V=await fetch("/api/controlnet/multi",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(k)}),L=await V.json();if(!V.ok)throw new Error(L.message||`APIé”™è¯¯: ${V.status}`);if(!L.success)throw new Error(L.message||"ç”Ÿæˆå¤±è´¥");return console.log("âœ… å¤šControlNetç”ŸæˆæˆåŠŸ"),{success:!0,image:L.image}}catch(k){const V=k instanceof Error?k.message:"æœªçŸ¥é”™è¯¯";return console.error("âŒ å¤šControlNetç”Ÿæˆå¤±è´¥:",V),Ae({type:U.API,message:"å¤šControlNetç”Ÿæˆå¤±è´¥",details:V,recoverable:!0,suggestions:["æ£€æŸ¥ç½‘ç»œè¿æ¥","ç¡®ä¿åç«¯æœåŠ¡æ­£å¸¸è¿è¡Œ","æ£€æŸ¥ControlNetæ¨¡å‹æ˜¯å¦å·²åŠ è½½","å°è¯•å‡å°‘ControlNetæ•°é‡"]}),{success:!1,message:V}}finally{t(2,s=!1)}}return r.$$set=c=>{"controlnets"in c&&t(0,l=c.controlnets)},[l,u,s,a,o,f,E,d,g]}class Qt extends we{constructor(e){super(),Ie(this,e,Kt,Mt,Ne,{controlnets:0,getControlNets:6,validate:7,generate:8})}get getControlNets(){return this.$$.ctx[6]}get validate(){return this.$$.ctx[7]}get generate(){return this.$$.ctx[8]}}class Ut{constructor(){Ge(this,"handlers",new Map)}register(e,t){const l=this.getKeyString(e);this.handlers.has(l)||(this.handlers.set(l,[]),this.setupListener(l));const u=this.handlers.get(l);return u.push(t),()=>{const s=u.indexOf(t);s>-1&&u.splice(s,1),u.length===0&&this.handlers.delete(l)}}getKeyString(e){const t=[];return e.ctrl&&t.push("ctrl"),e.alt&&t.push("alt"),e.shift&&t.push("shift"),e.meta&&t.push("meta"),t.push(e.key.toLowerCase()),t.join("+")}setupListener(e){if(typeof window>"u")return;const t=l=>{const u=this.parseKeyString(e);if(this.matches(l,u)){const s=this.handlers.get(e);if(s)for(const a of s)a(l)===!1&&(l.preventDefault(),l.stopPropagation())}};window.addEventListener("keydown",t)}parseKeyString(e){const t=e.split("+"),l={key:""};for(const u of t)switch(u.toLowerCase()){case"ctrl":l.ctrl=!0;break;case"alt":l.alt=!0;break;case"shift":l.shift=!0;break;case"meta":l.meta=!0;break;default:l.key=u}return l}matches(e,t){return!(e.key.toLowerCase()!==t.key.toLowerCase()||t.ctrl!==void 0&&e.ctrlKey!==t.ctrl||t.alt!==void 0&&e.altKey!==t.alt||t.shift!==void 0&&e.shiftKey!==t.shift||t.meta!==void 0&&e.metaKey!==t.meta)}}const Xt=new Ut;export{Jt as E,zt as K,Qt as M,Xt as k};
