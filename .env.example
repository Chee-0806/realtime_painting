# ArtFlow - 实时 AI 图像生成应用
# 环境变量配置示例文件
#
# 使用方法：
# 1. 复制此文件为 .env：cp .env.example .env
# 2. 根据需要修改 .env 文件中的配置
# 3. 环境变量优先级高于 config.yaml 文件
#
# 配置语法：
# - 使用前缀 STREAMDIFFUSION_
# - 使用双下划线 __ 表示嵌套结构
# - 例如：STREAMDIFFUSION_MODEL__MODEL_ID 对应 config.model.model_id

# =============================================================================
# 模型配置 (Model Configuration)
# =============================================================================

# 主扩散模型的 Hugging Face ID
# 常用选项：
# - stabilityai/sd-turbo (推荐，快速)
# - stabilityai/sd-xl-turbo (高质量，较慢)
# - runwayml/stable-diffusion-v1-5 (经典模型)
STREAMDIFFUSION_MODEL__MODEL_ID=stabilityai/sd-turbo

# 加速方式选择：
# - xformers: 推荐大多数GPU，减少显存使用
# - tensorrt: 最高性能，需要首次编译时间
# - none: 无加速，使用标准PyTorch
STREAMDIFFUSION_MODEL__ACCELERATION=xformers

# 自定义 VAE 模型 (可选)
# STREAMDIFFUSION_MODEL__VAE_ID=stabilityai/sd-vae-ft-mse

# 模型优化选项
STREAMDIFFUSION_MODEL__USE_TINY_VAE=true     # 使用 Tiny VAE 提升速度
STREAMDIFFUSION_MODEL__USE_LCM_LORA=true     # 使用 LCM LoRA 减少步数

# =============================================================================
# 服务器配置 (Server Configuration)
# =============================================================================

# 服务器监听地址 (0.0.0.0 表示接受所有连接)
STREAMDIFFUSION_SERVER__HOST=0.0.0.0

# 服务器端口
STREAMDIFFUSION_SERVER__PORT=8000

# 最大队列大小 (0 表示无限制)
STREAMDIFFUSION_SERVER__MAX_QUEUE_SIZE=0

# 会话超时时间，单位秒 (0 表示无超时)
STREAMDIFFUSION_SERVER__TIMEOUT=0

# 启用 NSFW 内容检测
STREAMDIFFUSION_SERVER__USE_SAFETY_CHECKER=false

# 日志级别：DEBUG | INFO | WARNING | ERROR | CRITICAL
# DEBUG: 详细调试信息
# INFO: 一般信息 (推荐)
# WARNING: 警告信息
# ERROR: 错误信息
STREAMDIFFUSION_LOG_LEVEL=INFO

# ============================================================
# Canvas 画板配置
# ============================================================

# 生成参数
STREAMDIFFUSION_CANVAS_GENERATION__WIDTH=512
STREAMDIFFUSION_CANVAS_GENERATION__HEIGHT=512
STREAMDIFFUSION_CANVAS_GENERATION__STEPS=2
STREAMDIFFUSION_CANVAS_GENERATION__CFG_SCALE=2.0
STREAMDIFFUSION_CANVAS_GENERATION__DENOISE=0.3
STREAMDIFFUSION_CANVAS_GENERATION__SEED=502923423887318

# 文本配置
STREAMDIFFUSION_CANVAS_GENERATION__PROMPT=
STREAMDIFFUSION_CANVAS_GENERATION__NEGATIVE_PROMPT=

# 性能配置
STREAMDIFFUSION_CANVAS_PERFORMANCE__ENABLE_SIMILAR_IMAGE_FILTER=false
STREAMDIFFUSION_CANVAS_PERFORMANCE__JPEG_QUALITY=95
STREAMDIFFUSION_CANVAS_PERFORMANCE__WARMUP=10

# ============================================================
# Realtime 实时配置
# ============================================================

# 生成参数（继承canvas基础配置）
STREAMDIFFUSION_REALTIME_GENERATION__WIDTH=512
STREAMDIFFUSION_REALTIME_GENERATION__HEIGHT=512
STREAMDIFFUSION_REALTIME_GENERATION__STEPS=2
STREAMDIFFUSION_REALTIME_GENERATION__CFG_SCALE=2.0
STREAMDIFFUSION_REALTIME_GENERATION__DENOISE=0.3
STREAMDIFFUSION_REALTIME_GENERATION__SEED=502923423887318

# 文本配置
STREAMDIFFUSION_REALTIME_GENERATION__PROMPT=
STREAMDIFFUSION_REALTIME_GENERATION__NEGATIVE_PROMPT=

# 实时性能配置
STREAMDIFFUSION_REALTIME_PERFORMANCE__ENABLE_SIMILAR_IMAGE_FILTER=true
STREAMDIFFUSION_REALTIME_PERFORMANCE__SIMILAR_IMAGE_FILTER_THRESHOLD=0.98
STREAMDIFFUSION_REALTIME_PERFORMANCE__SIMILAR_IMAGE_FILTER_MAX_SKIP_FRAME=10
STREAMDIFFUSION_REALTIME_PERFORMANCE__JPEG_QUALITY=85
STREAMDIFFUSION_REALTIME_PERFORMANCE__MAX_FPS=30

# ============================================================
# Txt2Img 文本生成配置
# ============================================================

# 生成参数
STREAMDIFFUSION_TXT2IMG_GENERATION__WIDTH=512
STREAMDIFFUSION_TXT2IMG_GENERATION__HEIGHT=512
STREAMDIFFUSION_TXT2IMG_GENERATION__STEPS=4
STREAMDIFFUSION_TXT2IMG_GENERATION__CFG_SCALE=7.5
STREAMDIFFUSION_TXT2IMG_GENERATION__DENOISE=0.0
STREAMDIFFUSION_TXT2IMG_GENERATION__SEED=-1

# 文本配置
STREAMDIFFUSION_TXT2IMG_GENERATION__PROMPT=
STREAMDIFFUSION_TXT2IMG_GENERATION__NEGATIVE_PROMPT=

# 文本生成专用参数
STREAMDIFFUSION_TXT2IMG_GENERATION__GUIDANCE_SCALE=7.5

# 性能配置
STREAMDIFFUSION_TXT2IMG_PERFORMANCE__ENABLE_SIMILAR_IMAGE_FILTER=false
STREAMDIFFUSION_TXT2IMG_PERFORMANCE__JPEG_QUALITY=90
STREAMDIFFUSION_TXT2IMG_PERFORMANCE__WARMUP=10

# =============================================================================
# TensorRT 特定配置 (TensorRT Specific Configuration)
# =============================================================================

# TensorRT 引擎缓存目录 (默认: ./engines)
# STREAMDIFFUSION_TENSORRT__ENGINE_DIR="./engines"

# 启用 CUDA Graph 优化 (仅 TensorRT 模式)
# STREAMDIFFUSION_TENSORRT__USE_CUDA_GRAPH=true

# =============================================================================
# 开发环境配置 (Development Configuration)
# =============================================================================

# 调试模式 (启用更详细的日志)
# DEBUG=false

# 开发模式自动重载
# AUTO_RELOAD=true

# 前端开发服务器地址 (用于 CORS 配置)
# FRONTEND_URL="http://localhost:5173"

# =============================================================================
# 生产环境配置 (Production Configuration)
# =============================================================================

# 环境类型 (development | production)
# ENVIRONMENT="development"

# 工作进程数量 (生产环境)
# WORKERS=1

# CORS 允许的源地址 (多个用逗号分隔)
# CORS_ORIGINS="http://localhost:5173,https://yourdomain.com"

# =============================================================================
# 监控配置 (Monitoring Configuration)
# =============================================================================

# 启用 Prometheus 指标
# ENABLE_METRICS=false

# 指标服务端口
# METRICS_PORT=9090

# 健康检查间隔，单位秒
# HEALTH_CHECK_INTERVAL=30

# =============================================================================
# 高级配置 (Advanced Configuration)
# =============================================================================

# GPU 设备 ID (默认: 0，使用第一个GPU)
# CUDA_VISIBLE_DEVICES=0

# 内存优化
# PYTORCH_CUDA_ALLOC_CONF=max_split_size_mb:128

# 模型缓存目录 (Hugging Face)
# HF_HOME="./cache/models"

# 下载线程数
# HF_HUB_DOWNLOAD_THREADS=4

# =============================================================================
# 故障排除 (Troubleshooting)
# =============================================================================

# 如果遇到显存不足，可以尝试：
# 1. 降低图像尺寸 (WIDTH/HEIGHT)
# 2. 启用 USE_TINY_VAE=true
# 3. 使用 xformers 加速
# 4. 减少 STEPS 数量

# 如果遇到生成质量问题，可以尝试：
# 1. 增加 STEPS 数量 (2-4)
# 2. 调整 CFG_SCALE (1.5-3.0)
# 3. 修改 DENOISE 强度 (0.2-0.5)
# 4. 优化提示词

# TensorRT 编译失败时：
# 1. 检查 CUDA 版本兼容性
# 2. 确保有足够的磁盘空间 (10GB+)
# 3. 使用 xformers 作为替代方案