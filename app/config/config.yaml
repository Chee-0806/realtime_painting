# StreamDiffusion Backend 配置文件

# 模型配置
model:
  model_id: "stabilityai/sd-turbo"
  acceleration: "xformers"  # xformers | tensorrt | none
  engine_dir: "engines"  # TensorRT 引擎缓存目录
  use_cuda_graph: false  # CUDA Graph 优化（仅 TensorRT，启用可进一步提升性能）
  # 内存优化配置
  enable_model_cpu_offload: false  # CPU卸载（降低GPU内存使用但增加延迟）
  enable_sequential_cpu_offload: false  # 顺序CPU卸载
  torch_dtype: "float16"  # 使用半精度节省内存
  
# Pipeline 配置
pipeline:
  name: "img2img"  # Pipeline 类型：img2img | txt2img | controlnet | inpainting
  mode: "image"  # image | video
  width: 512
  height: 512
  use_tiny_vae: true  # 使用 Tiny VAE 节省内存
  use_lcm_lora: true
  warmup: 10  # warmup 步骤数
  frame_buffer_size: 1
  use_denoising_batch: true

# 内存优化配置
memory:
  enable_lazy_loading: true  # 启用懒加载模式
  enable_model_offloading: false  # 模型卸载（实验性）
  max_concurrent_models: 1  # 最大同时加载的模型数量
  
# 性能配置（画板专用，保持不变）
performance:
  enable_similar_image_filter: false  # 画板禁用相似图像过滤，确保每次绘制都被处理
  similar_image_filter_threshold: 0.98  # 相似度阈值（0-1，越高越严格）
  similar_image_filter_max_skip_frame: 10  # 最大跳帧数
  jpeg_quality: 95  # 画板使用更高质量

# 实时生成专用配置
realtime:
  performance:
    enable_similar_image_filter: true  # 实时生成启用相似图像过滤，降低延迟
    similar_image_filter_threshold: 0.98  # 相似度阈值（0-1，越高越严格）
    similar_image_filter_max_skip_frame: 10  # 最大跳帧数
    jpeg_quality: 85  # 实时生成使用标准质量
    max_fps: 30  # 最大帧率限制
  
# 服务器配置
server:
  host: "0.0.0.0"
  port: 8000
  max_queue_size: 0  # 最大队列大小，0 表示无限制
  timeout: 0  # 会话超时（秒），0 表示无限制
  use_safety_checker: false  # NSFW 内容检测
  
# 日志配置
logging:
  level: "INFO"  # DEBUG | INFO | WARNING | ERROR | CRITICAL
  format: "text"  # json | text (推荐使用 text 便于调试)
  
# CORS 配置
cors:
  allow_origins:
    - "http://localhost:5173"
    - "http://localhost:3000"
  allow_credentials: true
  allow_methods:
    - "*"
  allow_headers:
    - "*"
